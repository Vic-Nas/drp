{% extends "admin/base_site.html" %}
{% block title %}Broadcast Email | drp{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
  <a href="{% url 'admin:index' %}">Home</a>
  â€º <a href="{% url 'admin:auth_user_changelist' %}">Users</a>
  â€º Broadcast Email
</div>
{% endblock %}

{% block content_title %}<h1>ðŸ“§ Broadcast Email</h1>{% endblock %}

{% block content %}
{% if messages %}
  {% for message in messages %}
    <p class="{% if message.tags %}{{ message.tags }}{% endif %}">{{ message }}</p>
  {% endfor %}
{% endif %}

{% if preview_recipients %}
<div style="background:#f8f8c8;border:1px solid #c8c800;padding:1rem;margin-bottom:1.5rem;border-radius:4px">
  <strong>Preview â€” not sent yet.</strong>
  Will send to <strong>{{ preview_count }}</strong> recipient(s):
  <details style="margin-top:.5rem">
    <summary style="cursor:pointer">Show addresses</summary>
    <ul style="margin-top:.5rem;column-count:2">
      {% for email in preview_recipients %}<li>{{ email }}</li>{% endfor %}
    </ul>
  </details>
</div>
{% endif %}

<form method="post" style="max-width:700px">
  {% csrf_token %}

  <div class="form-row">
    <label><strong>Recipient group</strong></label>
    <select name="group" style="width:100%;padding:.4rem;margin-top:.3rem">
      {% for key, label in groups %}
        <option value="{{ key }}" {% if key == group_key %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="form-row" style="margin-top:1rem">
    <label><strong>Subject</strong></label>
    <input type="text" name="subject" value="{{ subject }}"
           style="width:100%;padding:.4rem;margin-top:.3rem" required/>
  </div>

  <div class="form-row" style="margin-top:1rem">
    <label><strong>Body</strong> <span style="color:#999;font-weight:normal">(plain text)</span></label>
    <textarea name="body" rows="12"
              style="width:100%;padding:.4rem;margin-top:.3rem;font-family:monospace"
              required>{{ body }}</textarea>
  </div>

  <div style="margin-top:1.2rem;display:flex;gap:.8rem">
    <button type="submit" name="preview" value="1"
            style="padding:.5rem 1.2rem;background:#79aec8;color:#fff;border:none;border-radius:4px;cursor:pointer">
      Preview recipients
    </button>
    <button type="submit"
            style="padding:.5rem 1.2rem;background:#417690;color:#fff;border:none;border-radius:4px;cursor:pointer"
            onclick="return confirm('Send this email to all recipients in the selected group?')">
      Send now
    </button>
    <a href=".." style="padding:.5rem 1rem;color:#417690">Cancel</a>
  </div>
</form>
{% endblock %}