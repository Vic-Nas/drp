{% extends 'base.html' %}
{% block title %}drp / {{ bin.key }}{% endblock %}

{% block content %}
<section class="bin-header">
  <h2>/ {{ bin.key }}</h2>
  <div class="bin-actions">
    <button class="btn-sm" onclick="copyLink()">copy link</button>
    <a href="/b/{{ bin.key }}/key-file/" class="btn-sm">download key file</a>
  </div>
</section>

<section class="upload-box compact" id="uploadBox">
  <div class="drop-zone small" id="dropZone">
    <span>drop more files or <label for="fileInput" class="link">browse</label></span>
    <input type="file" id="fileInput" multiple hidden/>
  </div>
  <button id="uploadBtn" class="btn" disabled>upload</button>
</section>

<section class="file-grid">
  {% if files %}
    {% for f in files %}
    <div class="file-card" id="file-{{ f.id }}">
      <span class="fname">{{ f.filename }}</span>
      <span class="fsize">{{ f.size|filesizeformat }}</span>
      <div class="faction">
        <a href="/b/{{ bin.key }}/file/{{ f.id }}/download/" class="btn-sm">↓</a>
        <button class="btn-sm danger" onclick="deleteFile({{ f.id }})">✕</button>
      </div>
    </div>
    {% endfor %}
  {% else %}
    <p class="empty">no files yet.</p>
  {% endif %}
</section>
{% endblock %}

{% block scripts %}
<script>
  const BIN_KEY = '{{ bin.key }}';
  const UPLOAD_URL = '/b/{{ bin.key }}/upload/';

  function copyLink() {
    navigator.clipboard.writeText(window.location.href);
    showToast('link copied!');
  }

  async function deleteFile(fileId) {
    if (!confirm('Delete this file?')) return;
    const res = await fetch(`/b/${BIN_KEY}/file/${fileId}/delete/`, { method: 'DELETE', headers: {'X-CSRFToken': getCookie('csrftoken')} });
    if (res.ok) document.getElementById(`file-${fileId}`).remove();
  }
</script>
{% endblock %}